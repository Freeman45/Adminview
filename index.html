<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard</title>
<style>
body { font-family: Arial, sans-serif; background: #111; color: #fff; padding: 20px; }
h2 { color: #bc13fe; }
table { width: 100%; border-collapse: collapse; margin-top: 20px; }
th, td { border: 1px solid #444; padding: 10px; text-align: left; }
th { background: #222; }
td { background: #1a1a1a; }
input, button { padding: 5px; border-radius: 5px; border: 1px solid #bc13fe; background: #222; color: #fff; }
button { cursor: pointer; background: #bc13fe; border: none; }
</style>
</head>
<body>
<h2>Admin Dashboard</h2>
<table id="msgTable">
<tr>
  <th>Alias</th>
  <th>Message</th>
  <th>Reply</th>
  <th>Action</th>
</tr>
</table>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyvD5r3LE94iIFVUI8A9l_IaH-oLL7DXxirpKlQ1Ba4jIb0Lz6rdV649Cevzl4wd2UR/exec";

async function fetchMessages() {
  const res = await fetch(WEB_APP_URL);
  const messages = await res.json();
  const table = document.getElementById('msgTable');

  // Clear old rows
  table.innerHTML = `<tr>
    <th>Alias</th>
    <th>Message</th>
    <th>Reply</th>
    <th>Action</th>
  </tr>`;

  messages.forEach(msg => {
    const row = table.insertRow();
    row.insertCell(0).textContent = msg.alias || msg.Alias || "Anonymous";
    row.insertCell(1).textContent = msg.message || msg.Message || "";
    
    const replyCell = row.insertCell(2);
    const replyInput = document.createElement("input");
    replyInput.value = msg.Reply || "";
    replyCell.appendChild(replyInput);

    const actionCell = row.insertCell(3);
    const btn = document.createElement("button");
    btn.textContent = "Save Reply";
    btn.onclick = async () => {
      await fetch(WEB_APP_URL, {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ messageId: msg.MessageID || msg.messageId, reply: replyInput.value })
      });
      alert("Reply saved");
    };
    actionCell.appendChild(btn);
  });
}

// Refresh every 10 seconds
fetchMessages();
setInterval(fetchMessages, 10000);
</script>
</body>
</html>
